# Sert Tutorial

## Connecting to Sert

The first step for submiting the job is to connect to the remote server.
This can be done in several ways depending on where you are.
Normally you find yourself out of the intranet network so you have to connect to a gateway.
This can be done with the following command where you replace *username* by your particular username.

```bash
ssh username@gw.ac.upc.edu
```

When you enter to the server you will find yourself in the gateway.
In order to move your scrach directory you will need to first discover in which partition of the disc it is.
New accounts ususally are on the 4 partition.
The following command can be run to move to your scratch area by replacing *username* with your username and *num* with the partition.

```bash
cd /scratch/nas/num/username
```

## Submiting a job to Sert

Sert works with a job system where you request the server to run a script.
You have to follow the following steps for each execution:
1. Write the script to run
2. Submit the job to the queue
3. Wait for the job to finish
4. You can now read the results generated by your script

We are going to make a simple example of this process.
We first write the script.
Due to only being connected through a terminal we need to use a terminal editor to write the script.
For begginer users it is recomended to use the command:

```bash
nano example_script.sh
```

For user with proficiency on more advanced editors like VIM, they can be used.

```bash
vim example_script.sh
```

Our example script will simply display a message on *stdout*.
The script for doing it, would be the following.

```bash
#!/bin/bash

#SBATCH --chdir=/scratch/nas/num/username
#SBATCH --job-name="test_job"
#SBATCH --output=/scratch/nas/num/username/stdout-%j.out
#SBATCH --error=/scratch/nas/num/username/stderr-%j.out

echo "Hello from the job"
```

Now that our script is written we only need to put it in the queue.
This is done through the *sbatch* command.
In our example this can be done with:

```bash
sbatch example_script.sh
```

Once the job is submited you can visualize all you current jobs with:

```bash
squeue -u username
```

## Transfering data to Sert

Data can be transfered to Sert by using secure copy.
This command must be executed *on your machine* not on Sert.

```bash
scp -r directory_to_copy username@gw.ac.upc.edu:/scratch/nas/num/username/.
scp file_to_copy username@gw.ac.upc.edu:/scratch/nas/num/username/.
```

For dowloading data the same can be done, remember to run this commands *on your machine*.


```bash
scp -r username@gw.ac.upc.edu:/scratch/nas/num/username/directory_to_copy .
scp username@gw.ac.upc.edu:/scratch/nas/num/username/file_to_copy .
```

However, the use of *zip* for high volumes of data is recomended.
This requieres more commands to be executed but faster transfer speed.
You first need to compress the folder or file by executing.

```bash
zip -r folder_to_transfer
zip file_to_transfer
```

You the upload or download the file as previously stated.
When you have it in the desired machine you can simply uncompress it with.

```bash
unzip my_file.zip
```

## Advanced usage of sbatch

We submitting a job several parameters can be specified to contraint in which nodes the job can be run.
This parameters are firstly the type of nodes to be used.
Boolean operation can be used to make sets of this contraints.
The following categories exist:
- node-2014
- node-2016
- node-2017
- node-2019

The previous categories can be used as following.
The example uses both 2019 and 2017 nodes.

```bash
sbatch --constraint="node-2017|node-2019" myjob.sh
```

By default the jobs are limited to 4 hours of execution time you can set the queue type in order to increase this time limit.
Be mindfull that bigger queues have lower priority.

Queue|Time Limit
-----|----------
all|4 hours
big|2 days
huge|15 days

An example could be:
```bash
sbatch -q big myjob.sh
```

The amount of memory can be also set through an argument.
The default value is *2GB* in order to increase it use.


```bash
sbatch --mem=8G myjob.sh
```
